# Interrupt

## 中断入口

根据中断的入口跳转方法的不同，中断可分为向量中断和非向量中断：

* 向量中断：采用向量中断的CPU通常为不同的中断分配不同的中断号，当检测到某个中断号的中断到来后，就自动跳转到该中断号对应的地址执行。不同的中断号的中断有不同的入口地址；
* 非向量中断：非向量中断的多个中断共享一个入口地址，进入该入口地址后，再通过软件判断中断标志来识别具体是哪个中断。

向量中断由硬件提供中断服务程序入口地址，非向量中断由软件提供中断服务程序入口地址。

## GIC(Generic Interrupt Controller)

在ARM多核处理器里最常用的中断控制器是GIC，通常支持3种类型的中断：
* SGI(Software Generated Interrupt)：软件产生的中断，可以用于多核的核间通信，一个CPU可以通过GIC的寄存器给另外一个CPU产生中断；
* PPI(Private Peripheral Interrupt)：某个CPU私有外设的中断，这类外设的中断只能给绑定的那个CPU；
* SPI(Shared Peripheral Interrupt)：共享外设的中断，这类外设的中断可以路由到任何一个CPU；

在ARM Linux默认情况下，中断都是在CPU0上产生的，可以通过代码将中断irq设定到指定CPUx上去；

## 中断处理架构

`---> 中断 ---> 上半部（紧急的硬件操作） ---> 下半部（延缓的耗时操作）`

* 上半部程序一般设计成不可终端；
* 下半部程序可被中断；
* 如果上半部程序完全能够处理，下半部程序不一定是必须的，可选；
* `pro/interrupts`查看系统中中断的统计信息，显示出每个中断号上的中断在每个CPU上发生的次数；
* Linux实现中断下半部的机制主要是tasklet、工作队列、软中断和线程化irq；
* Linux中断号和中断处理函数可以在代码中动态绑定：
  * request_irq()
  * free_irq()

